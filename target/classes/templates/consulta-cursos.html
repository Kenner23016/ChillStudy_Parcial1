<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ver Cursos - ChillStudy</title>
  <link rel="icon" href="/favicon.png" type="image/png">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body>

<div th:replace="~{fragmentos/sidebar :: sidebar}" th:with="active='curso-lista'"></div>
<div th:replace="fragmentos/logout :: logout-button"></div>


<div class="main">
  <h2>Cursos Registrados</h2>

  <!-- Mensajes -->
  <div id="mensaje" th:if="${param.mensaje}" class="message" style="color: green;">
    <p th:text="${param.mensaje}"></p>
  </div>
  <div id="error" th:if="${param.error}" class="message" style="color: red;">
    <p th:text="${param.error}"></p>
  </div>
  <div id="mensaje" th:if="${mensaje}" class="message" style="color: green;">
    <p th:text="${mensaje}"></p>
  </div>
  <div id="error" th:if="${error}" class="message" style="color: red;">
    <p th:text="${error}"></p>
  </div>

  <script>
    setTimeout(() => {
      const mensaje = document.getElementById("mensaje");
      const error = document.getElementById("error");
      if (mensaje) mensaje.style.display = "none";
      if (error) error.style.display = "none";
    }, 10000);
  </script>

  <form method="get" th:action="@{/cursos/lista}" class="filter-form">
  <select name="categoria">
    <option th:value="__null__"
            th:selected="${categoriaSeleccionada == null}">
      Todas las categorías
    </option>
    <option th:each="cat : ${categorias}"
            th:value="${cat}"
            th:text="${cat}"
            th:selected="${cat == categoriaSeleccionada}">
    </option>
  </select>

  <select name="dificultad">
    <option th:value="__null__"
            th:selected="${dificultadSeleccionada == null}">
      Todos los niveles
    </option>
    <option th:each="nivel : ${niveles}"
            th:value="${nivel}"
            th:text="${#strings.capitalize(nivel.name().toLowerCase())}"
            th:selected="${nivel == dificultadSeleccionada}">
    </option>
  </select>

  <button type="submit">Filtrar</button>
</form>

  <!-- Tabla de cursos -->
  <table>
    <th>Nombre</th>
    <th>Categoría</th>           <!-- ➕ -->
    <th>Nivel</th>               <!-- ➕ -->
    <th th:if="${roles != null and roles.contains('Admin')}">Acciones</th>
  </tr>
</thead>
<tbody>
  <tr th:each="curso : ${cursos}">
    <td th:text="${curso.nombre}"></td>
    <td th:text="${curso.categoria}"></td>          <!-- ➕ -->
    <td th:text="${#strings.capitalize(curso.dificultad.name().toLowerCase())}"></td> <!-- ➕ -->
    <td th:if="${roles != null and roles.contains('Admin')}"> … </td>
  </tr>
</tbody>
  </table>

  <!-- Paginación estandarizada -->
  <div class="pagination" th:if="${totalPages > 1}">
    <a th:if="${currentPage > 0}" th:href="@{|?page=${currentPage - 1}|}">⬅️ Anterior</a>

    <a th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
       th:href="@{|?page=${i}|}"
       th:text="${i + 1}"
       th:classappend="${i == currentPage} ? 'active' : ''">
    </a>

    <a th:if="${currentPage < totalPages - 1}" th:href="@{|?page=${currentPage + 1}|}">Siguiente ➡️</a>
  </div>

  <!-- Botón Nuevo Curso solo para Admin -->
  <a th:if="${roles != null and roles.contains('Admin')}"
     th:href="@{/cursos/nuevo}"
     class="btn edit-btn"
     style="margin-top: 20px; display: inline-block;">
     ➕ Nuevo Curso
  </a>
</div>

<script>
  function confirmarEliminacion(elemento) {
    const url = elemento.getAttribute("data-url");
    Swal.fire({
      title: '¿Estás seguro?',
      text: "Esta acción no se puede deshacer.",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Sí, eliminar',
      cancelButtonText: 'Cancelar'
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = url;
      }
    });
  }
</script>

</body>
</html>
